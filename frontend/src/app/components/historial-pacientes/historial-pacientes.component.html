<div class="historial-container">
  <h2>Historial Clínico de Pacientes</h2>

  <!-- Formulario de búsqueda -->
  <form [formGroup]="formularioBusqueda" (ngSubmit)="buscarPaciente()" class="busqueda-form">
    <div class="form-group">
      <label for="rutBusqueda">RUT del Paciente</label>
      <div class="busqueda-container">
        <input 
          type="text" 
          id="rutBusqueda" 
          formControlName="rutBusqueda" 
          placeholder="Ej: 12.345.678-9" 
          [class.is-invalid]="rutInvalido"
          required />
        <button type="submit" class="btn-buscar" [disabled]="formularioBusqueda.invalid || cargando">
          {{ cargando ? 'Buscando...' : 'Buscar' }}
        </button>
      </div>
      <div *ngIf="rutInvalido" class="invalid-feedback">
        {{ mensajeValidacionRut }}
      </div>
    </div>
  </form>

  <!-- Mensaje de error -->
  <div *ngIf="mensajeError" class="mensaje-error">
    {{ mensajeError }}
  </div>

  <!-- Información del paciente encontrado -->
  <div *ngIf="pacienteEncontrado" class="paciente-info">
    <h3>Paciente encontrado:</h3>
    <p><strong>Nombre:</strong> {{ pacienteEncontrado.nombre }}</p>
    <p><strong>RUT:</strong> {{ pacienteEncontrado.rut }}</p>
  </div>

  <!-- Formulario de historial clínico -->
  <form *ngIf="pacienteEncontrado" [formGroup]="formularioHistorial" (ngSubmit)="guardarHistorial()" class="historial-form">
    <div class="form-group">
      <label for="fecha">Fecha de Consulta</label>
      <input type="datetime-local" id="fecha" formControlName="fecha" required [max]="maxDate" />
    </div>

    <div class="form-group">
      <label for="diagnostico">Diagnóstico</label>
      <textarea id="diagnostico" formControlName="diagnostico" rows="3" required></textarea>
    </div>

    <div class="form-group">
      <label for="tratamiento">Tratamiento</label>
      <textarea id="tratamiento" formControlName="tratamiento" rows="3" required></textarea>
    </div>

    <div class="form-group">
      <label for="medicamentosRecetados">Medicamentos Recetados</label>
      <textarea id="medicamentosRecetados" formControlName="medicamentosRecetados" rows="3" required></textarea>
    </div>

    <div class="form-group">
      <label for="observaciones">Observaciones</label>
      <textarea id="observaciones" formControlName="observaciones" rows="3" required></textarea>
    </div>

    <button type="submit" class="btn-guardar" [disabled]="!formularioHistorial.valid">Guardar Historial</button>
  </form>
</div>
