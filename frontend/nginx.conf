http {
  # … tus otros upstreams, gzip, etc …

  upstream compfact {
    server microservicio-de-compras-facturacion:8082;
  }
  upstream backend_pacientes {
    server gps-backend:8080;
  }

  server {
    listen 80;
    root /usr/share/nginx/html;
    index index.html;

    ## 1) Todas las /api/compras/* → compfact:8082
    location ^~ /api/compras/ {
      proxy_pass         http://compfact;
      proxy_set_header   Host              $host;
      proxy_set_header   X-Real-IP         $remote_addr;
      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Proto $scheme;

      # (CORS — puedes copiar tus add_header de tu bloque /api/)
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'Origin, X-Requested-With, Content-Type, Accept, Authorization';
      add_header Access-Control-Allow-Credentials true;
      if ($request_method = 'OPTIONS') { return 204; }
    }
    }
    ## 2) Todas las /api/facturas/* → compfact:8082
    location ^~ /api/facturas/ {
      proxy_pass         http://compfact;
      proxy_set_header   Host              $host;
      proxy_set_header   X-Real-IP         $remote_addr;
      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Proto $scheme;
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'Origin, X-Requested-With, Content-Type, Accept, Authorization';
      add_header Access-Control-Allow-Credentials true;
      if ($request_method = 'OPTIONS') { return 204; }
    }
    }
    ## 3) Todas las /api/guias-despacho/* → compfact:8082
    location ^~ /api/guias-despacho/ {
      proxy_pass         http://compfact;
      proxy_set_header   Host              $host;
      proxy_set_header   X-Real-IP         $remote_addr;
      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Proto $scheme;
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'Origin, X-Requested-With, Content-Type, Accept, Authorization';
      add_header Access-Control-Allow-Credentials true;
      if ($request_method = 'OPTIONS') { return 204; }
    }

    ## 4) El resto de /api/* → gps-backend:8080
    location /api/ {
      proxy_pass         http://backend_pacientes;
      proxy_set_header   Host              $host;
      proxy_set_header   X-Real-IP         $remote_addr;
      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Proto $scheme;
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'Origin, X-Requested-With, Content-Type, Accept, Authorization';
      add_header Access-Control-Allow-Credentials true;
      if ($request_method = 'OPTIONS') { return 204; }
    }

    ## 5) Tu aplicación Angular
    location / {
      try_files $uri $uri/ /index.html;
    }}}
    
}
}
